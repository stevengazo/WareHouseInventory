@model Models.Product

@using Models;

@{
  ViewData["Title"] = "Producto";
  Layout = "_LayoutAdmin";
  int counter = 0;
}

<h1>Detalles</h1>

<div class="d-flex flex-row">
  <div class="row">

    <div>
      <h4>Producto</h4>
      <hr />
      <dl class="row">
        <dt class="col-sm-2">
          Nombre
        </dt>
        <dd class="col-sm-10">
          @Html.DisplayFor(model => model.Name)
        </dd>
        <dt class="col-sm-2">
          Descripci칩n
        </dt>
        <dd class="col-sm-10">
          @Html.DisplayFor(model => model.Description)
        </dd>
        <dt class="col-sm-2">
          Precio de Compra
        </dt>
        <dd class="col-sm-10">
          $ @Html.DisplayFor(model => model.Buy_Price)
        </dd>
        <dt class="col-sm-2">
          Precio Venta
        </dt>
        <dd class="col-sm-10">
          $ @Html.DisplayFor(model => model.Sell_Price)
        </dd>
      </dl>
    </div>
  </div>
  <div class="row">
    @if (Model.ProductImages.Count > 0)
    {
      <img
        src="@($"Data:image/PNG;base64,{Convert.ToBase64String(Model.ProductImages.First().File)}")" class=" border rounded" style="width: 15rem;" alt="..." />    
    }
    else
    {
      <img
        src="..." class="" style="width: rem;" alt="..." />    
    }

  </div>
</div>

<div>
  <a class="btn btn-outline-info" asp-action="Edit"
    asp-route-id="@Model?.ProductId">Editar</a> |
  <a class="btn btn-outline-info" asp-action="Index">Volver a la lista</a> |
@if(Model.ProductImages.Count > 0){
  <a class="btn btn-outline-danger" asp-controller="Photo" asp-action="Delete" asp-route-id="@Model.ProductId">Borrar Fotogr치fia</a> 
}else{
  <a class="btn btn-outline-primary" asp-controller="Photo" asp-action="Create" asp-route-id="@Model.ProductId">A침adir Fotogr치fia</a> 
}

  </div>
  <h1>Almacenes</h1>
    @foreach (WareHouse item in @ViewBag.WareHouses)
    {
      counter = counter + 1;
      string dat = $"collapse{counter.ToString()}";
      <div class="accordion" id="accordionExample">
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button" type="button" data-bs-toggle="collapse"
              data-bs-target="#@dat" aria-expanded="true"
              aria-controls="@dat">
              Almacen - @item.Name
            </button>
          </h2>
          <div id="@dat" class="accordion-collapse collapse show"
            aria-labelledby="headingOne" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <table class="table table-light">
                <thead class="thead-light">
                  <tr>
                    <th>Fecha Asociacion</th>
                    <th>Cantidad Existente</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  @foreach (Inventory ite in @ViewBag.Inventory)
                  {
                    var isvalid = (ite.QuantityOfExistances >= 1) ? true : false;
                    if (ite.WareHouseId == item.WareHouseId)
                    {
                          <tr>
                            <td>
                          @ite.CreationDate.ToString("dd-MMM-yyyy")
                            </td>
                        @if (isvalid)
                        {
                                <td>
                            @ite.QuantityOfExistances
                                </td>
                        }
                        else
                        {
                                <td class="text-danger">
                                  No Hay Existencias
                                </td>
                        }
                            <th>
                              <a class="btn btn-sm btn-outline-info"
                                asp-controller="Inventory" asp-action="Details"
                                asp-route-id="@ite.InventoryId">Ver Registro</a>
                              <a class="btn btn-sm btn-outline-success" asp-controller="Entry"
                                asp-action="Createbyinventory" asp-route-id="@ite.InventoryId">Entrada</a>
                          @if (isvalid)
                          {
                                  <a class="btn btn-sm btn-outline-danger" asp-controller="Exit"
                                    asp-action="CreatebyInventory" asp-route-id="@ite.InventoryId">Salida</a>
                          }
                            </th>
                          </tr>
                    }
                  }
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    }
